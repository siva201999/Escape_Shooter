
Components.utils.import("resource://gre/modules/XPCOMUtils.jsm");var CI=Components.interfaces;var CC=Components.classes;var yahooCC=CC;var yahooCI=CI;var loader=CC["@mozilla.org/moz/jssubscript-loader;1"].getService(CI.mozIJSSubScriptLoader);loader.loadSubScript("chrome://ytoolbar/content/yprefs.js");loader.loadSubScript("chrome://ytoolbar/content/logger.js");loader.loadSubScript("chrome://ytoolbar/content/utils.js");loader.loadSubScript("chrome://ytoolbar/content/ytb_gradient_generator.js");function WrapperClass(object){this.wrappedJSObject=this;this.object=object;}
WrapperClass.prototype={QueryInterface:function(iid){if(!iid.equals(Components.interfaces.nsISupports)){throw Components.results.NS_ERROR_NO_INTERFACE;}
return this;}}
function YahooDomBuilder(){var _self=this;var _mNS="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";var _mImagePath="http://us.i1.yimg.com/us.yimg.com/i/tb/icons/";var _mPopupStyle="";var _mColorGroupButtonText="black";var _mColorButtonText="black";var _mColorSearchButtonText="black";var _mColorSearchButtonOutline="";var _mSrchBgColor="";var _mSrchEdgeColor="";var _mIsGradientColorOn="";var _mSrchGradientColor1="";var _mSrchGradientColor2="";var _mIsDropArrowShow="";var _mSubMenuBtnNavigate="";var _mDropArrowTopPosition="";var _mDropArrow="";var _mHoverImage="";var _mAppHoverImage="";var _mDocument=null;var _mGradientGenerator=null;var _mToolbarDocument=null;var sysPrincipal=null;var domParser=null;var skinData="{}";this.yahooFaviconButtons="";this.init=function(){try{if(CC["@mozilla.org/xre/app-info;1"].getService(CI.nsIXULAppInfo).platformVersion.split(".")[0]>"1"){sysPrincipal=Components.classes['@mozilla.org/systemprincipal;1'].createInstance(Components.interfaces.nsIPrincipal);domParser=CC["@mozilla.org/xmlextras/domparser;1"].createInstance(CI.nsIDOMParser);domParser.init(sysPrincipal,null,null);_mDocument=domParser.parseFromString("<?xml version=\"1.0\" encoding=\"utf-8\"?> <overlay xmlns=\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\" xmlns:svg=\"http://www.w3.org/2000/svg\" />","text/xml");}else{_mDocument=CC["@mozilla.org/xul/xul-document;1"].createInstance(CI.nsIDOMDocument).implementation.createDocument(_mNS,"overlay",null);}
_mGradientGenerator=new YAHOO.YTFF.GradientGenerator(_mDocument.createElementNS("http://www.w3.org/1999/xhtml","canvas"));if(CC["@mozilla.org/xre/app-info;1"].getService(CI.nsIXULAppInfo).platformVersion.split(".")[0]>"1"){_mToolbarDocument=domParser.parseFromString("<?xml version=\"1.0\" encoding=\"utf-8\"?> <overlay xmlns=\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\" xmlns:svg=\"http://www.w3.org/2000/svg\" id=\"toolbar\" />","text/xml");}else{_mToolbarDocument=CC["@mozilla.org/xul/xul-document;1"].createInstance(CI.nsIDOMDocument).implementation.createDocument(_mNS,"overlay",null);_mToolbarDocument.firstChild.setAttribute("id","toolbar");}}catch(e){yahooError(e);}
_self.clear();};var _mConfigManager=CC["@yahoo.com/configmanager;1"].getService(CI.nsIYahooConfigManager);var _mStrings=CC["@mozilla.org/intl/stringbundle;1"].getService(CI.nsIStringBundleService).createBundle("chrome://ytoolbar/locale/ytoolbar.properties");var _mLocalStorage=CC["@yahoo.com/localstorage;1"].getService(CI.nsIYahooLocalStorage);var _mFileIO=CC["@yahoo.com/fileio;1"].getService(CI.nsIYahooFileIO2);var _mSkipAttrs={'id':1,'contextmenu':1,'image':1,'class':1,'tooltiptext':1,'type':1};var _mRightAlignBtns=null;var _mAddEditBtn=null;var _mGroupBtns=null;var _mRightSepImg=null;var _mContainer=null;var _mReqBtns=null;var _mSplitter=null;var _mBtns=null;var _mFAVDom=null;var _mTabIndex=0;var _mInsideGroup=false;var _mBaseGroupImage="ddddddddddskins/noskin_grp.png";var _mBaseEndCapImage="ddddddddddddskins/noskin_ec.png";function _getStr(name,def){var str=null;if(_mStrings){str=_mStrings.GetStringFromName(name);}
if(!str&&def){return def;}
return str;}
function _collectAlertData(dom){try
{var multiplealerts_data=[];var attr=dom.getAttribute("yhash");if(attr!=undefined){if(attr=="")attr="{}";var tokens=yahooUtils.JSON.parse(attr);for(name in tokens){var k=name;var v=tokens[name];k=k.replace(/^\s+|\s+$/g,"");k=k.replace(/^\'|\'$/g,"");if(v!=undefined){v=v.replace(/^\s+|\s+$/g,"");v=v.replace(/^\'|\'$/g,"");}
switch(k){case"alrt":multiplealerts_data["alrt"]=v;break;case"alint":multiplealerts_data["alint"]=v*60;break;case"algst":multiplealerts_data["algst"]=v;break;case"alco":multiplealerts_data["alco"]=v;break;default:}
if((v!=undefined)&&(v.indexOf("AE_")!=-1)){if(multiplealerts_data["displayElement"]==null){multiplealerts_data["displayElement"]=[];}
multiplealerts_data["displayElement"].push(k);}}}
if(multiplealerts_data["alrt"]!=undefined){if(_mLocalStorage!=null){var alert_array=_mLocalStorage.getObject("alert");if(alert_array!=null){alert_array=alert_array.wrappedJSObject.object;}
if(alert_array==undefined){alert_array=[];}
var alertIDsWithInterval=multiplealerts_data["alrt"].split(",");for(i in alertIDsWithInterval)
{var alertdata=[];var alertIDs=alertIDsWithInterval[i].split(":");if(alertIDs[0]!=undefined)
{alertdata["alrt"]=alertIDs[0];}
if(alertIDs[1]!=undefined)
{alertdata["alint"]=alertIDs[1]*60;}
else if(multiplealerts_data['alint']!=undefined)
{alertdata["alint"]=multiplealerts_data['alint'];}
if(alertdata["alint"]==undefined)
{alertdata["alint"]=420;}
if(multiplealerts_data["algst"]!=undefined)
{alertdata["algst"]=multiplealerts_data["algst"];}
if(multiplealerts_data["alco"]!=undefined)
{alertdata["alco"]=multiplealerts_data["alco"];}
if(multiplealerts_data["displayElement"]!=undefined)
{alertdata["displayElement"]=multiplealerts_data["displayElement"];}
alert_array.push(alertdata);}
_mLocalStorage.putObject("alert",new WrapperClass(alert_array));}else{}}else{}}catch(e){yahooError("Error in _collectAlertData "+e);}}
function _createSplitter(){var splitter=_mToolbarDocument.createElementNS(_mNS,"splitter");splitter.id="yahoo-toolbar-splitter";splitter.setAttribute("resizebefore","grow");splitter.setAttribute("resizeafter","grow");splitter.setAttribute("class","searchbox-splitter");splitter.setAttribute("onmouseup","YAHOO.YTFF.ToolbarBuilder.splitterResize()");splitter.setAttribute("onclick","YAHOO.YTFF.ToolbarBuilder.setSearchboxSize()");return splitter;}
function _buildSearchBox(node,hash){var search=null;var dom=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");dom.setAttribute("class","ytff-searchbox-container");dom.setAttribute("flex","1");dom.setAttribute("minwidth","80");dom.setAttribute("width","300");dom.setAttribute("maxheight","26");dom.setAttribute("align","center");if(hash["usesd"]=="1"){dom.style.margin="3px 0px 3px 3px";}
if(_mColorSearchButtonOutline!="")
dom.setAttribute("outlineColor",_mColorSearchButtonOutline);var srchBgColor;if((_mSrchBgColor!=null)&&(_mSrchBgColor!="")){srchBgColor=_mSrchBgColor;}else{srchBgColor="white";}
try{var search=_mToolbarDocument.createElementNS(_mNS,"textbox");search.setAttribute("id","yahooToolbarEditBox");search.setAttribute("flex","1");search.setAttribute("height",23);search.setAttribute("width",212);search.setAttribute("style","padding-top:3px;margin: 1px 5px 5px 5px; border: 1px inset #716f64; align: center; height: 23px");search.setAttribute("yevent",node.func);search.setAttribute("ytrack",node.funcTracking);search.setAttribute("yfunc",node.funcNum);search.setAttribute("yhash",node.hash);search.setAttribute("ystyles",node.styles);var url=node.funcUrl;url=url.substring(1,url.indexOf(","));search.setAttribute("yurl",url);search.setAttribute("newlines","replacewithspaces");search.setAttribute("width",_mConfigManager.getIntValue("search.editboxwidth"));var searchHash=yahooUtils.JSON.parse(node.hash);search.setAttribute("ylive",unescape(searchHash.live));search.setAttribute("class","yahoo-toolbar-search-box");var bgColorStyle="background:"+srchBgColor+";";var srchHash=searchHash.ptf;if(srchHash)
{var varStyle=srchHash.split(";");for(var i=0;i<varStyle.length;i++){var pair=varStyle[i].split(":");if(pair[0]=="fs")
{var ovFontSize=parseInt(pair[1],10);srchHash=srchHash.replace("fs:"+ovFontSize,"fs:"+(ovFontSize+2)+"px");break;}}}
var searchTextPosStyle="padding-left:"+searchHash.editLeftPosition+"px !important;";search.setAttribute("ptfStyle",yahooUtils.formatStyleInformation(srchHash?(srchHash+bgColorStyle+searchTextPosStyle):bgColorStyle+searchTextPosStyle));search.setAttribute("sbfStyle",yahooUtils.formatStyleInformation(searchHash.sbf?(searchHash.sbf+bgColorStyle+searchTextPosStyle):bgColorStyle+searchTextPosStyle));if(searchHash.popup_url)_mConfigManager.setCharValue("search.popup_src",searchHash.popup_url,true);var tempStyle=yahooUtils.formatStyleInformation(srchHash)+bgColorStyle;search.setAttribute("style",tempStyle);search.setAttribute("value",searchHash.pt);search.yselect=true;var crossMarkSection=_mToolbarDocument.createElementNS(_mNS,"toolbarbutton");crossMarkSection.setAttribute("id","yahooSearchCrossMark");crossMarkSection.setAttribute("class","ytff-search-crossmark");crossMarkSection.setAttribute("no_delete","true");search.appendChild(crossMarkSection);dom.appendChild(search)}catch(e){yahooError("Error in _buildSearchBox "+e);}
var srchboxColor,gradientColor1,gradientColor2;srchboxColor=(_mSrchEdgeColor!="")?_mSrchEdgeColor:"#7590f5";var srchStyle="border: 1px solid "+srchboxColor+"; background:"+srchBgColor+";";dom.setAttribute("searchStyle",srchStyle);return dom;}
function _prepareTicker(dom){dom.setAttribute("class","ytff-button-highlightbackground-separator-dropmarker-slideout-ticker");dom.setAttribute("minwidth","50");dom.setAttribute("bgImageClick",dom.getAttribute("bgImagePress"));}
function _processStyles(node,dom,hash){if(node.styles.indexOf("NOTEXT")>-1){dom.setAttribute("no_label","true");}
if(node.styles.indexOf("ALWAYSHIDE")>-1||node.id=="yahoo-toolbar-srch_hlt"){dom.setAttribute("hidden",true);}
if(node.id!==null&&node.styles.indexOf("REMOVEONCLICK")>-1){_self.removables[_self.removables.length]=dom;}
if(node.styles.indexOf("HIGHLIGHTICON")>-1&&node.icon){var icon=node.icon;var pos=icon.lastIndexOf(".");icon=icon.substr(0,pos)+"_h"+icon.substr(pos);dom.setAttribute("yicon_h",icon);dom.setAttribute("bgImage","");dom.setAttribute("bgImageNormal","");dom.setAttribute("bgImageHover","");dom.setAttribute("bgImagePress","");dom.setAttribute("bgImageClick","");}
if(node.styles.indexOf("MINIMIZABLE")>-1){dom.setAttribute("flex","1");}
if(node.styles.indexOf("TITLEMENU")>-1)
{dom.setAttribute("disabled","true");dom.style.fontWeight="bold";dom.style.textAlign="left";dom.style.color="black";}
dom.setAttribute("ystyles",node.styles);if(dom.ownerDocument.firstChild&&dom.ownerDocument.firstChild.id=="toolbar"&&node.type!=node.EDITBOX_TYPE&&node.styles.indexOf("NOTOOLTIP")==-1){dom.setAttribute("tooltiptext",unescape(node.name));if(hash.at){var tt="";var tooltip=unescape(hash.at);if(tooltip){tooltip=tooltip.replace(/%2525/g,"");tooltip=tooltip.replace(/%25/g,"");tooltip=tooltip.replace(/%|\$|,/g,"");dom.setAttribute("tooltiptext",tooltip);}}}}
function _prepareRightButtons(dom,node){if(node.id.indexOf("yahoo-toolbar-grp_")==-1&&node.styles.indexOf('EX_FAVICON')==-1){dom.setAttribute("no_label","true");}
if(node.id.indexOf("yahoo-toolbar-grp_")>-1){_mGroupBtns.appendChild(dom);return;}
if(node.id.indexOf("yahoo-toolbar-add_")>-1){var btn=_mRightSepImg.nextSibling;if(btn&&btn.getAttribute("id")=="yahoo-toolbar-vert_toggle_ff")
btn=btn.nextSibling;if(btn){_mRightAlignBtns.insertBefore(dom,btn);return;}}
_mRightAlignBtns.appendChild(dom);}
function _prepareGroupButton(dom,node,hash){var skin_base=_self.buildImageUrl('','');var grpImg=_mBaseGroupImage.split(".")[0];var grpImgExtn="."+_mBaseGroupImage.split(".")[1];var ecapImg=_mBaseEndCapImage.split(".")[0];var ecapImgExtn="."+_mBaseEndCapImage.split(".")[1];var GROUP_LEFT_IMG=skin_base+grpImg+"_lt"+grpImgExtn;var GROUP_RIGHT_IMG=skin_base+grpImg+"_rt"+grpImgExtn;var GROUP_LEFT_HOVER_IMG=skin_base+grpImg+"_lt_h"+grpImgExtn;var GROUP_RIGHT_HOVER_IMG=skin_base+grpImg+"_rt_h"+grpImgExtn;var CAP_CLOSE_IMG=skin_base+ecapImg+"_s0"+ecapImgExtn;var CAP_OPEN_IMG=skin_base+ecapImg+"_s1"+ecapImgExtn;var CAP_CLOSE_HOVER_IMG=skin_base+ecapImg+"_s0_h"+ecapImgExtn;var CAP_OPEN_HOVER_IMG=skin_base+ecapImg+"_s1_h"+ecapImgExtn;var builder=_mGradientGenerator;dom.setAttribute("flex","1");dom.setAttribute("current_image_group_vert",GROUP_RIGHT_IMG);dom.setAttribute("image_group_vert",GROUP_RIGHT_IMG);dom.setAttribute("image_group_vert_hover",GROUP_RIGHT_HOVER_IMG);dom.setAttribute("image_cap_closed",CAP_CLOSE_IMG);dom.setAttribute("image_cap_closed_hover",CAP_CLOSE_HOVER_IMG);dom.setAttribute("image_cap_open",CAP_OPEN_IMG);dom.setAttribute("image_cap_open_hover",CAP_OPEN_HOVER_IMG);dom.setAttribute("image_group",GROUP_LEFT_IMG);dom.setAttribute("image_group_hover",GROUP_LEFT_HOVER_IMG);dom.setAttribute("group_cap_style","background:url('"+GROUP_LEFT_IMG+"');cursor:pointer;color:"+_mColorGroupButtonText);dom.setAttribute("group_button_style","background:url('"+GROUP_LEFT_IMG+"');cursor:pointer;color:"+_mColorGroupButtonText);dom.setAttribute("group_content_style","padding-left:0px;padding-right:0px;background:url('"+GROUP_LEFT_IMG+"');color:"+_mColorGroupButtonText);dom.setAttribute("style","margin-left:1px;color:"+_mColorGroupButtonText);if(hash["vertid"]&&(hash["vertid"]!=_mConfigManager.getCharValue("installer.activeVertical")))
_mConfigManager.setCharValue("installer.activeVertical",hash["vertid"],true);}
function _prepareNormalButton(dom,node){try{var builder=_mGradientGenerator;dom.setAttribute("bgImage","");dom.setAttribute("bgImageNormal","");var NORMAL_BUTTON_HOVER=(_mHoverImage!="")?_self.buildImageUrl(_mHoverImage):"chrome://ytoolbar/skin/button-hover-shortcut.png";var DROPMARKER_BUTTON_HOVER=(_mAppHoverImage!="")?_self.buildImageUrl(_mAppHoverImage):"chrome://ytoolbar/skin/button-hover-shortcut.png";var Active_Hover=(_mHoverImage!="")?_self.buildImageUrl(_mHoverImage):"chrome://ytoolbar/skin/button-hover-shortcut.png";var Passive_Hover=(_mHoverImage!="")?_self.buildImageUrl(_mHoverImage):"chrome://ytoolbar/skin/button-hover-shortcut.png";_mFileIO.fetchNCacheImg((node.type==node.BUTTON_TYPE?NORMAL_BUTTON_HOVER:DROPMARKER_BUTTON_HOVER),"bgImageHover",dom);_mFileIO.fetchNCacheImg((node.type==node.BUTTON_TYPE?NORMAL_BUTTON_HOVER:DROPMARKER_BUTTON_HOVER),"bgImagePress",dom);_mFileIO.fetchNCacheImg((node.type==node.BUTTON_TYPE?NORMAL_BUTTON_HOVER:DROPMARKER_BUTTON_HOVER),"bgImageClick",dom);_mFileIO.fetchNCacheImg(Active_Hover,"bgImageActive",dom);_mFileIO.fetchNCacheImg(Passive_Hover,"bgImagePassive",dom);var dropArrowUp,dropArrowDown,dropArrowDownHover;if(_mDropArrow!=""){var stateIndex=_mDropArrow.lastIndexOf(".png");dropArrowUp=_mDropArrow.substring(0,stateIndex)+"_p"+".png";dropArrowUp=_self.buildImageUrl(dropArrowUp);dropArrowDown=_self.buildImageUrl(_mDropArrow);dropArrowDownHover=_mDropArrow.substring(0,stateIndex)+"_h"+".png";dropArrowDownHover=_self.buildImageUrl(dropArrowDownHover);}
var defaultDropArrow="chrome://ytoolbar/skin/arrow_dn.png";var defaultDropArrowUp="chrome://ytoolbar/skin/arrow_up.png";_mFileIO.fetchNCacheImg((defaultDropArrowUp),"dropmarkerUpImage",dom);_mFileIO.fetchNCacheImg((dropArrowDownHover?dropArrowDownHover:defaultDropArrow),"dropmarkerDownImage",dom);_mFileIO.fetchNCacheImg((dropArrowDown?dropArrowDown:defaultDropArrow),"dropmarkerImageNormal",dom);_mFileIO.fetchNCacheImg((dropArrowDown?dropArrowDown:defaultDropArrow),"dropmarkerImage",dom);if(node.id=="yahoo-toolbar-vsrch"||node.id=="yahoo-toolbar-fin_quotes"){dom.setAttribute("buttonTextColor",_mColorSearchButtonText);dom.setAttribute("arrowUpImage",dropArrowUp?dropArrowUp:defaultDropArrowUp);dom.setAttribute("arrowDownImage",dropArrowDown?dropArrowDown:defaultDropArrow);dom.setAttribute("arrowImageStyle",dropArrowDown?dropArrowDown:defaultDropArrow);}else{dom.setAttribute("buttonTextColor",_mColorButtonText);dom.setAttribute("iconLabelStyle","color:"+_mColorButtonText);}}catch(e){yahooError(e);}}
function _setDomFont(dom,value){var fontParams=value.split(";")
for(var idx=0;idx<fontParams.length;idx++){var kv=fontParams[idx].split(":");switch(kv[0]){case"c":dom.style.color=kv[1];dom.setAttribute("buttonTextColor",kv[1]);dom.setAttribute("buttonTextColor_p",kv[1]);dom.setAttribute("iconLabelStyle","color:"+kv[1]);break;case"ff":dom.style.fontFamily=kv[1];break;case"fs":dom.style.fontSize=""+(parseInt(kv[1])+2)+"px";break;case"fw":var weight="normal"
if(kv[1]=="b"){weight="bold";}
dom.style.fontWeight=weight;break;}}}
function _processYHash(node,dom,hash){_mImagePath=_self.buildImageUrl('','');for(name in hash){var value=hash[name];var idx=0;switch(name){case"f_1":case"f_2":case"f_0":case"f":_setDomFont(dom,value);break;case"backn":dom.setAttribute("bgImage",_mImagePath+value);dom.setAttribute("bgImageNormal",_mImagePath+value);dom.setAttribute("bgImageHover",_mImagePath+value);dom.setAttribute("bgImagePress",_mImagePath+value);dom.setAttribute("bgImageClick",_mImagePath+value);break;case"backp":dom.setAttribute("bgImagePress",_mImagePath+value);dom.setAttribute("bgImageClick",_mImagePath+value);break;case"backh":dom.setAttribute("bgImageHover",_mImagePath+value);break;case"adjoin":if(value=='l')
{dom.style.margin="0px 4px 0px 0px";}
else if((value=='r')||(hash["usesd"]!='1'))
{dom.style.margin="2px 0px 2px 4px";}
dom.setAttribute(name,value);break;case"gedgec":if(!dom.hasAttribute("outlineColor"))
dom.setAttribute("outlineColor",value);break;case"width":dom.setAttribute("y_width",value);break;case"minw":dom.setAttribute("y_min_width",value);dom.setAttribute("y_grp_min_width",value-60);break;case"maxw":dom.setAttribute("y_max_width",value);dom.setAttribute("y_grp_max_width",value-60);break;case"tbhod":case"usesd":case"popx":case"popy":dom.setAttribute(name,value);break;}}}
function _processBookmarks(node,hash){if(node.id=="yahoo-toolbar-boo"&&hash.prm&&hash.api){_self.bm2Feed=(unescape(hash.api)+"?"+unescape(hash.prm));if(hash.bmfoldersave){_self.bm2FolderSave=unescape(hash.bmfoldersave);}else{yahooDebug("NO bmboldersave");}
if(hash.bmimporturl){_self.bm2FFBMImportUrl=unescape(hash.bmimporturl);}}
if("yahoo-toolbar-boo_m/boo_m_6/boo_m_6_1"==node.id&&hash.bmimport){if(hash.bmimport){_self.bm2FFBMImportCrumb=unescape(hash.bmimport);}}}
function _makeDomAccessible(dom){dom.setAttribute("tabindex",_mTabIndex++);dom.setAttribute("accesibileType",1023);}
function _createToolbarChild(node,parent,hash){if(node&&node.id&&node.id.indexOf("yahoo-toolbar-spr")>-1){var dom=parent.ownerDocument.createElementNS(_mNS,"splitter");var popup=null;}else{var dom=parent.ownerDocument.createElementNS(_mNS,"toolbarbutton");var popup=null;}
switch(node.type){case node.BUTTON_TYPE:dom.setAttribute("class","ytff-button-highlightbackground");if(node&&node.id&&node.id.indexOf("yahoo-toolbar-spt_liv")>-1){dom.setAttribute("class","ytff-button-live-game");}
if(node&&node.id&&node.id.indexOf("yahoo-toolbar-ecap_grp")>-1){_mInsideGroup=false;}
if(node&&node.id&&node.id.indexOf("yahoo-toolbar-vsrch")>=0){dom.setAttribute("class","ytff-button-search");}
if(node&&node.id&&node.id.indexOf("yahoo-toolbar-spr")>-1){dom.setAttribute("class","ytff-searchbox-splitter");}
if(node&&node.id&&node.id.indexOf("like_this_page_fb")>=0){dom.setAttribute("class","ytff-button-like-this-page");}
break;case node.SIZER_TYPE:dom=parent.ownerDocument.createElementNS(_mNS,"splitter");dom.setAttribute("hidden","false");dom.setAttribute("resizebefore","flex");dom.setAttribute("resizeafter","grow");break;case node.GROUP_TYPE:if(node.id.indexOf("grp_")>=0){dom=parent.ownerDocument.createElementNS(_mNS,"toolbaritem");dom.setAttribute("maxheight","32");dom.setAttribute("class","ytff-button-group");popup=dom.appendChild(parent.ownerDocument.createElementNS(_mNS,"menupopup"));popup.setAttribute("style",_mPopupStyle);popup.setAttribute("position","after_end");popup.setAttribute("id","yahoo-toolbar-vert-popup");_mInsideGroup=true;_mFAVDom=dom;_self.groupId=node.id;if(_self.groupId.indexOf("yahoo-toolbar-")==0){_self.groupId=_self.groupId.substr(14);}
_prepareGroupButton(dom,node,hash);}
break;case node.TICKER_TYPE:{_prepareTicker(dom);}
break;case node.BUTTONMENU_TYPE:case node.MODULE_TYPE:case node.MODULEMENU_TYPE:popup=dom.appendChild(parent.ownerDocument.createElementNS(_mNS,"menupopup"));if(node&&node.id&&hash&&hash.ysoid){if(_mIsDropArrowShow!=""){dom.setAttribute("class",(_mIsDropArrowShow==0)?"ytff-button-highlightbackground-slideout-hidearrow":"ytff-button-highlightbackground-separator-dropmarker-slideout");}else{dom.setAttribute("class","ytff-button-highlightbackground-separator-dropmarker-slideout");}
if(node.styles.indexOf("HIDEARROW")>=0)
{dom.setAttribute("class","ytff-button-highlightbackground-slideout-hidearrow");}
popup.setAttribute("hidden","true")}
else{popup.setAttribute("style",_mPopupStyle);var subMenuBtnClass;if(_mSubMenuBtnNavigate!=""){subMenuBtnClass=(_mSubMenuBtnNavigate==0)?"ytff-button-highlightbackground-dropmarker":"ytff-button-highlightbackground-separator-dropmarker";}
else{subMenuBtnClass="ytff-button-highlightbackground-separator-dropmarker";}
if(_mIsDropArrowShow!=""){dom.setAttribute("class",(_mIsDropArrowShow==0)?"ytff-button-highlightbackground-menu-hidearrow":subMenuBtnClass);}else{dom.setAttribute("class",subMenuBtnClass);}
if(node.styles.indexOf("HIDEARROW")>=0)
{dom.setAttribute("class","ytff-button-highlightbackground-menu-hidearrow");}
popup.setAttribute("style",_mPopupStyle);}
break;case node.MENU_TYPE:if(_mIsDropArrowShow!=""){dom.setAttribute("class",(_mIsDropArrowShow==0)?"ytff-button-highlightbackground-menu-hidearrow":"ytff-button-highlightbackground-dropmarker");}else{dom.setAttribute("class","ytff-button-highlightbackground-dropmarker");}
popup=dom.appendChild(parent.ownerDocument.createElementNS(_mNS,"menupopup"));popup.setAttribute("style",_mPopupStyle);break;case node.MENUITEM_TYPE:break;case node.EDITBOX_TYPE:dom=_buildSearchBox(node,hash);break;case node.SEPARATOR_TYPE:dom=null;dom=parent.ownerDocument.createElementNS(_mNS,"toolbarseparator");if(node.id=="yahoo-toolbar-spt_sep")
{dom.setAttribute("class","ytff-separator-toolbar");}else{dom.setAttribute("class","ytff-separator-invisible");}
break;case node.INJECTO_TYPE:dom=parent.ownerDocument.createElementNS(_mNS,"injecto");dom.setAttribute("hidden","true");break;default:dom=null;}
if(popup){popup.style.color="black";}
return{domNode:dom,popupNode:popup};}
function _createNonToolbarChild(node,parent,hash){var dom=parent.ownerDocument.createElementNS(_mNS,"menuitem");var popup=null;switch(node.type){case node.MENUITEM_TYPE:if(node&&node.id&&hash&&hash.ysoid){dom.setAttribute("class","ytff-button-highlightbackground-slideout");}
case node.BUTTON_TYPE:case node.TICKER_TYPE:case node.GROUP_TYPE:break;case node.BUTTONMENU_TYPE:case node.MENU_TYPE:case node.MODULE_TYPE:case node.MODULEMENU_TYPE:dom=parent.ownerDocument.createElementNS(_mNS,"menu");popup=dom.appendChild(parent.ownerDocument.createElementNS(_mNS,"menupopup"));break;case node.SEPARATOR_TYPE:dom=parent.ownerDocument.createElementNS(_mNS,"menuseparator");break;case node.EDITBOX_TYPE:dom=null;default:dom=null;}
return{domNode:dom,popupNode:popup};}
function _createMenuDom(node,dom){var mdom=null,mpopup=null;var _filter="yahoo-toolbar-srch_ebox,yahoo-toolbar-vsrch,yahoo-toolbar-sep_grp_fav,yahoo-toolbar-grp_spt,yahoo-toolbar-pres,yahoo-toolbar-spr";_filter+="yahoo-toolbar-score_tic,yahoo-toolbar-spo_tic,yahoo-toolbar-size_grp_spt";_filter+="yahoo-toolbar-capsrch";if(node.id&&_filter.indexOf(node.id)==-1&&node.id.indexOf("ult")==-1){switch(dom.nodeName){case"toolbarbutton":switch(dom.getAttribute("type")){case"menu":mdom=_mDocument.createElementNS(_mNS,"menu");mpopup=mdom.appendChild(_mDocument.createElementNS(_mNS,"menupopup"));break;case"":mdom=_mDocument.createElementNS(_mNS,"menuitem");break;default:mdom=_mDocument.createElementNS(_mNS,"menuitem");}
switch(dom.getAttribute("class")){case"ytff-button-highlightbackground-dropmarker":case"ytff-button-highlightbackground-menu-hidearrow":case"ytff-button-highlightbackground-separator-dropmarker":case"ytff-button-highlightbackground-slideout-hidearrow":case"ytff-button-highlightbackground-separator-dropmarker-slideout":mdom=_mDocument.createElementNS(_mNS,"menu");mpopup=mdom.appendChild(_mDocument.createElementNS(_mNS,"menupopup"));mdom.setAttribute("label",node.name);if(node.id){mdom.setAttribute("id","menu_"+node.id);}
mdom=mpopup.appendChild(_mDocument.createElementNS(_mNS,"menuitem"));mpopup.appendChild(_mDocument.createElementNS(_mNS,"menuseparator"));break;}
if(node.styles.indexOf("ALWAYSHIDE")>-1&&mdom){mdom.setAttribute("hidden","true");}
break;case"toolbarseparator":mdom=_mDocument.createElementNS(_mNS,"menuseparator");break;}}
return{mdomNode:mdom,mpopupNode:mpopup};}
function _prepareMenuDom(node,mdom,mpopup,dom,popup){if(node.id){if(mpopup!=null){mdom.setAttribute("id","menu_"+node.id+"_btn");}else{mdom.setAttribute("id","menu_"+node.id);}}
mdom.removeAttribute("class");mdom.removeAttribute("contextmenu");mdom.removeAttribute("tooltiptext");mdom.setAttribute("class","menuitem-iconic");mdom.style.display=dom.style.display;if(mpopup!=null){mdom=mpopup.parentNode;}
if(node.id&&node.styles.indexOf("REMOVEONCLICK")>-1){_self.removables[_self.removables.length]=dom;}
if(node.hash=="")node.hash="{}";if(node.styles.indexOf("ALWAYSHIDE")<0){if(node.parentNode&&node.parentNode.domMenubar){node.parentNode.domMenubar.appendChild(mdom);}else if(!node.parentNode){var sk=yahooUtils.JSON.parse(node.hash);if(!(node.hash&&(sk.menubarshow=="false"))){_self.menubar.appendChild(mdom);}}}
node.domMenubar=mpopup||mdom;}
function _iWantToDoAWorkAround(node,dom,hash){if(node.id=="yahoo-toolbar-rss"||node.id=="yahoo-toolbar-rss_m"||node.id=="yahoo-toolbar-RSS"||node.id=="menu_yahoo-toolbar-rss"||node.id=="menu_yahoo-toolbar-rss_m"||node.id=="menu_yahoo-toolbar-RSS"){dom.style.display="none";}
if(node.id=="yahoo-toolbar-cm-sio"){dom.setAttribute("type","checkbox");}
if(dom.parentNode==_mFAVDom&&dom.setAttribute&&!hash.ysoid&&!hash.ysoxx){dom.setAttribute("imgHeight","22");dom.setAttribute("imgWidth","22");}
if(node.id&&node.id.indexOf("yahoo-toolbar-@lb")>-1){dom.setAttribute("imgHeight","22");dom.setAttribute("imgWidth","22");}
if(node&&((node.styles&&node.styles.indexOf("EX_RIGHTJUSTIFYBAND")>-1)||(node.id&&node.id.indexOf("yahoo-toolbar-add_")>-1))){_prepareRightButtons(dom,node);}
if(node.id&&node.id.indexOf("yahoo-toolbar-add_grp_fav")==0){_mAddEditBtn.appendChild(dom);}
if(node.icon!==null&&node.icon!==""){dom.setAttribute("yicon",node.icon);_mFileIO.fetchNCacheImage(node.icon,dom);if(dom.tagName=="menuitem"&&dom.className==""){dom.className+="menuitem-iconic";}else if(dom.tagName=="menu"){dom.className+="menu-iconic";}}
if(node&&node.id&&(node.id.indexOf("size_grp_")>-1||node.id.indexOf("ecap_grp_")>-1)){dom.style.display="none";}
if(dom.tagName=="toolbarbutton"&&node&&node.id&&node.id.indexOf("yahoo-toolbar-spo_gallery_tic")>=0){dom.setAttribute("class","ytff-button-sport-gallery");dom.setAttribute("width","20px");dom.setAttribute("maxwidth","20px");dom.setAttribute("minwidth","20px");}
if(dom.tagName=="toolbarbutton"&&node&&node.styles.indexOf("HIGHLIGHTICON")>=0){dom.setAttribute("class",node.styles.indexOf("HIDEARROW")>=0?"ytff-button-highlighticon-hidearrow":"ytff-button-highlighticon");dom.setAttribute("type",node.type===node.MENU_TYPE?"menu":"");}}
function _setDirectDomAttributes(node,dom){if(node.id!=null){dom.setAttribute("id",node.id);}
dom.setAttribute("label",node.name);dom.setAttribute("yhash",node.hash);if(node.type==node.BUTTON_TYPE||node.type==node.MENUITEM_TYPE||node.type==node.BUTTONMENU_TYPE||node.type==node.TICKER_TYPE||node.type==node.MODULE_TYPE||node.type==node.MODULEMENU_TYPE||node.type==node.GROUP_TYPE){if(!dom.hasAttribute("oncommand")){dom.setAttribute("oncommand","YAHOO.YTFF.ButtonHandler(event);");if(!(dom.tagName=="menuitem"||dom.tagName=="menu")){dom.setAttribute("onclick","if(event.button == 1) YAHOO.YTFF.ButtonHandler(event);");}}
if(node.funcTracking==-1&&node.funcNum==0){dom.setAttribute("type","checkbox");dom.setAttribute("class","menuitem-iconic");dom.setAttribute("autocheck","false");dom.setAttribute("checked","true");node.icon=null;}
if(node.funcNum==9){dom.setAttribute("type","checkbox");dom.setAttribute("class","menuitem-iconic");dom.setAttribute("autocheck","false");node.icon=null;}
dom.setAttribute("yevent",node.func);dom.setAttribute("ytrack",node.funcTracking);dom.setAttribute("yfunc",node.funcNum);if(node.funcUrl!==null&&node.funcUrl!==""){var url=node.funcUrl;if((url.match("%")!==null)&&(url.match("$")!==null)){var prefs=CC["@mozilla.org/preferences-service;1"].getService(CI.nsIPrefBranch);var pc=_mConfigManager.getCharValue("toolbar.pc")||"";var lang=_mConfigManager.getCharValue("installer.language")||"us";var cc=lang+".";var cver=_mConfigManager.getCharValue("installer.version")||"1.1.0";url=url.replace("%","");url=url.replace(",$FSRV,%",_mLocalStorage.getString("yahoo.ytff.dataserver.url"));url=url.replace(",$ESRV,%",_mLocalStorage.getString("yahoo.ytff.dataserver.url"));url=url.replace(",$LANG,%",lang);url=url.replace(",$REG_pc,%",pc);url=url.replace(",$CVER,%",cver);}
dom.setAttribute('yurl',url);}}}
function _getParent(node,parent,hash){var toolbar=false;if(parent===null){parent=_self.toolbar;toolbar=true;if(node.id=="yahoo-toolbar-cm"){parent=_self.toolar_context;toolbar=false;}else if(node.id.indexOf("yahoo-toolbar-rmc")!=-1){parent=_self.page_context;toolbar=false;}else if(node.id=="yahoo-toolbar-acs"){_self.menubarExtra.appendChild(_mDocument.createElementNS(_mNS,"menuseparator"));return _self.menubarExtra;}else if(node.id=="yahoo-toolbar-add_grp_fav"){parent=_mAddEditBtn;}else if(node.id=="yahoo-toolbar-spr"){parent=_mSplitter;}else{if(node.id&&node.id.indexOf("yahoo-toolbar-fin_quotes")>-1){parent=_mReqBtns;}else if(_mFAVDom!=null&&node&&(node.id&&(node.id.indexOf("yahoo-toolbar-ecap_")!=-1||_self.groupId.indexOf(hash.grp)!=-1))||_mInsideGroup==true){if(hash.grp!=_self.groupId){node.hash="{\"grp\":\""+_self.groupId+"\","+node.hash.substr(1);}
parent=_mFAVDom;}else if(_mBtns.childNodes.length>0){parent=_mBtns;}else if(node.type==node.SEPARATOR_TYPE||(_mReqBtns.lastChild&&(_mReqBtns.lastChild.getAttribute("id")=="yahoo-toolbar-vsrch"||_mReqBtns.lastChild.getAttribute("id")=="yahoo-toolbar-fin_quotes"))){parent=_mBtns;}else if(node.id&&node.id.indexOf("yahoo-toolbar-pres")>-1){parent=_mRightAlignBtns;}else
{parent=_mReqBtns;}}}else if(parent==_self.alerts){toolbar=true;}
return{isToolbar:toolbar,parentNode:parent};}
this.toolbar=null;this.menubar=null;this.toolar_context=null;this.page_context=null;this.removables=[];this.bookmarks=null;this.bm2Feed=null;this.bm2Usage=[];this.bm2Prefs=[];this.bm2FolderSave=null;this.bm2FFBMImportCrumb=null;this.bm2FFBMImportUrl=null;this.iconsOnly=false;this.groupId="";this.groupLayout="";this.addNode=function(node,parent){var dom,popup;try{node.name=unescape(node.name);if(node.hash=="")node.hash="{}";var hash=yahooUtils.JSON.parse(node.hash);try{if(node.id){var id=node.id;if(id.indexOf("yahoo-toolbar-")==0){id=id.substr(14);}
_mLocalStorage.putObject(node.type==node.SKIN_TYPE?"yahoo-toolbar-skin.yhash":node.id+".yhash",new WrapperClass(hash));}}catch(e){yahooError(e);}
var result=_getParent(node,parent,hash);parent=result.parentNode;var product={domNode:null,popupNode:null};if(result.isToolbar){product=_createToolbarChild(node,parent,hash);}else{product=_createNonToolbarChild(node,parent,hash);}
dom=product.domNode;popup=product.popupNode;if(dom==null){return null;}
_prepareNormalButton(dom,node);if(node.id&&((_self.groupId!=""&&hash&&hash.grp==_self.groupId)||_mInsideGroup)){var id=node.id;if(id.indexOf("yahoo-toolbar-")==0)id=id.substr(14);_self.groupLayout+=id+",";}
_setDirectDomAttributes(node,dom);_processYHash(node,dom,hash);_processBookmarks(node,hash);if(dom.ownerDocument.firstChild&&dom.ownerDocument.firstChild.id=="toolbar"&&node.funcNum=="1"&&parent.parentNode&&parent.parentNode.id!="yahoo-toolbar-boo"){parent.parentNode.setAttribute("id","yahoo-toolbar-bookmarks-"+(node.funcTracking||1));}
parent.appendChild(dom);_processStyles(node,dom,hash);if(node.styles.indexOf('EX_FAVICON')>-1&&(node.funcUrl=="#C_FAVICONOFPAGE"||hash.favIconUrl=="#C_FAVICONOFPAGE")){if(this.yahooFaviconButtons.split(',').indexOf(node.id)<0)
{if(this.yahooFaviconButtons){this.yahooFaviconButtons+=","+node.id;}
else{this.yahooFaviconButtons=node.id;}}
var ovImage=hash.overlayImage;if(ovImage){var icon_url=_self.buildImageUrl(ovImage,hash.is);dom.setAttribute("ovImage",icon_url);dom.setAttribute("ovImageHidden","false");}
dom.setAttribute("imgHeight","22");dom.setAttribute("imgWidth","22");dom.setAttribute("defaultImage",node.icon);}
_iWantToDoAWorkAround(node,dom,hash);if(dom.ownerDocument.firstChild&&dom.ownerDocument.firstChild.id=="toolbar"){dom.setAttribute("contextmenu","yahoo-toolbar-context");}
var _skip=["yahoo-toolbar-add_grp_fav","yahoo-toolbar-ecap_grp_fav","yahoo-toolbar-ecap_grp_spt","yahoo-toolbar-add_grp_fav82","yahoo-toolbar-score_tic","yahoo-toolbar-spo_tic","yahoo-toolbar-size_grp_spt","yahoo-toolbar-size_grp_vert","yahoo-toolbar-ecap_grp_vert","yahoo-toolbar-spt_liv"];var flag=false;if(dom.ownerDocument.firstChild&&dom.ownerDocument.firstChild.id=="toolbar"){var mdom,mpopup;for(var i=0;i<_skip.length;i++)
if(_skip[i]==node.id){flag=true;break;}
if(node.id&&(node.id.indexOf("yahoo-toolbar-ult")>-1||flag==true)){}
else if(dom.nodeName.indexOf("toolbar")===0){product=_createMenuDom(node,dom);mdom=product.mdomNode;mpopup=product.mpopupNode;if(mdom){var attr;for(var i=0;i<dom.attributes.length;i++){attr=dom.attributes[i];if(_mSkipAttrs[attr.name]!=1){mdom.setAttribute(attr.name,attr.value);}}}}
else{if(parent.parentNode.id.indexOf("yahoo-toolbar-ult")==-1){mdom=_mDocument.createElementNS(_mNS,dom.nodeName);if(dom.nodeName==="menu"){mpopup=mdom.appendChild(_mDocument.createElementNS(_mNS,"menupopup"));}
for(var idx=0;idx<dom.attributes.length;idx++){attr=dom.attributes[idx];mdom.setAttribute(attr.name,attr.value);}
if(popup){mpopup=mdom.firstChild;}}}
if(mdom){_prepareMenuDom(node,mdom,mpopup,dom,popup);}}}catch(e){yahooError(e);}
if(popup){if(dom){try{popup.setAttribute("yhash",dom.getAttribute("yhash"));}catch(e){yahooError(e);}}
dom=popup;}
if(dom!=null){_collectAlertData(dom);}
mdom=null;mpopup=null;popup=null;node=null;return dom;}
this.buildImageUrl=function(image,iconSubDirectory){if(image&&(image.indexOf("chrome://")===0)){return image;}
var iconHost="l.yimg.com";var iconDir="\/nt\/i\/tb\/icons";if(_mLocalStorage.getString("i")!=null){iconHost=_mLocalStorage.getString("i");}
if(_mLocalStorage.getString("iu")!=null){iconDir=_mLocalStorage.getString("iu");}
if(iconSubDirectory&&image){imageUrl="http:\/\/"+iconHost+iconDir+"\/"+iconSubDirectory+"\/"+image;}else if(image){imageUrl="http:\/\/"+iconHost+iconDir+"\/"+image;}else{imageUrl="http:\/\/"+iconHost+iconDir+"\/";}
return imageUrl;};this.setSkinParams=function(node){if(node){var hash=node.hash;hash=hash.replace(/%2F/g,"/");hash=hash.replace(/%23/g,"#");this.skinData=hash;var sk=yahooUtils.JSON.parse(hash);var skin_base=_self.buildImageUrl('','');if(sk.skin_bk!=""){_mContainer.style.background="url('"+skin_base+sk.skin_bk
+"') repeat-x ";}
if(sk.skin_left!=""){_mReqBtns.style.background="url('"+skin_base+sk.skin_left
+"') no-repeat";}
_mGroupButtonTextColor="black";_mButtonTextColor="black";if(sk.skin_g_t_col){_mColorGroupButtonText=sk.skin_g_t_col;}
if(sk.skin_t_col){_mColorButtonText=sk.skin_t_col;}
_mColorSearchButtonText="black";if(sk.skin_s_t_col){_mColorSearchButtonText=sk.skin_s_t_col;}
_mColorSearchButtonOutline="";if(sk.skin_s_o_col){_mColorSearchButtonOutline=sk.skin_s_o_col;}
_mSrchBgColor="";if(sk.skin_s_bgcol){_mSrchBgColor=sk.skin_s_bgcol;}
_mSrchEdgeColor="";if(sk.skin_s_e_col){_mSrchEdgeColor=sk.skin_s_e_col;}
_mIsGradientColorOn="";if(sk.skin_s_g_col){_mIsGradientColorOn=sk.skin_s_g_col;}
_mSrchGradientColor1="";if(sk.skin_s_g_col1){_mSrchGradientColor1=sk.skin_s_g_col1;}
_mSrchGradientColor2="";if(sk.skin_s_g_col2){_mSrchGradientColor2=sk.skin_s_g_col2;}
_mIsDropArrowShow="";if(sk.skin_d_a){_mIsDropArrowShow=sk.skin_d_a;}
_mDropArrowTopPosition="";if(sk.skin_d_a_position_y){_mDropArrowTopPosition=sk.skin_d_a_position_y;}
_mDropArrow="";if(sk.skin_d_a_img){_mDropArrow=sk.skin_d_a_img;}
_mHoverImage="";if(sk.skin_b_h_a_img){_mHoverImage=sk.skin_b_h_a_img;}
_mAppHoverImage="";if(sk.skin_b_h_a_img){_mAppHoverImage=sk.skin_b_h_a_img;}
_mSubMenuBtnNavigate="";if(sk.skin_submenu_nav){_mSubMenuBtnNavigate=sk.skin_submenu_nav;}
_mReqBtns.style.paddingLeft=sk.skin_ofs+"px";_mGradientGenerator.setGroupGradient(""+sk.skin_c_bdrdk,""+sk.skin_c_bdrlt);_mGradientGenerator.setInternalGradient(""+sk.skin_g_bgtop,""+sk.skin_g_bgbot);_mGradientGenerator.setArrowColor(sk.skin_drop_col);var skinBtnColorHover="";if(sk.skin_button_hover){skinBtnColorHover=sk.skin_button_hover;}
var skinBtnColorPress="";if(sk.skin_button_press){skinBtnColorPress=sk.skin_button_press;}
var skinBtnColorHighlight=1;if(sk.skin_button_highlight){skinBtnColorHighlight=sk.skin_button_highlight;}
_mGradientGenerator.initGradients(skinBtnColorHighlight,skinBtnColorHover,skinBtnColorPress);var url=_mGradientGenerator.TOOLBAR_BACKGROUND;var tbStyle="background:url('"+url+"') repeat-x;padding:0px !important;margin:0px!important;border:none ! important";if(sk.skin_bk==""){_mContainer.setAttribute("style",tbStyle);}
if(sk.skin_icons&&sk.skin_icons!=""){var _NewStyleBtns=sk.skin_icons.split(";");for(var i=0;i<_NewStyleBtns.length;i++){switch(_NewStyleBtns[i].split(":")[0]){case"{grp_bc}":_mBaseGroupImage=_NewStyleBtns[i].split(":")[1];break;case"{grp_ec}":_mBaseEndCapImage=_NewStyleBtns[i].split(":")[1];break;default:break;}}}else{_mBaseGroupImage="skins/noskin_grp.png";_mBaseEndCapImage="skins/noskin_ec.png";}}}
this.clear=function(){try{_self.removables=[];_self.toolbar=null;_self.menubar=null;_self.menubarExtra=null;_self.toolar_context=null;_self.page_context=null;_self.alerts=null;_self.groupId="";_self.groupLayout="";_mSplitter=null;_mFAVDom=null;_mReqBtns=null;_mBtns=null;_mRightAlignBtns=null;_mTabIndex=50;_self.toolbar=_mToolbarDocument.createDocumentFragment();_self.menubar=_mDocument.createDocumentFragment();_self.menubarExtra=_mDocument.createDocumentFragment();_self.toolar_context=_mDocument.createDocumentFragment();_self.page_context=_mDocument.createDocumentFragment();_self.alerts=_mDocument.createDocumentFragment();_mLocalStorage.putObject("alert",new WrapperClass([]));_mLocalStorage.putObject("ORalert",new WrapperClass([]));_mLocalStorage.putObject("200",new WrapperClass([]));_mReqBtns=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");_mReqBtns.id="yahoo-toolbar-reqbtns";_mReqBtns.setAttribute("maxwidth","700");_mReqBtns.setAttribute("pack","begin");_mReqBtns.setAttribute("align","center");_mSplitter=_createSplitter();_mBtns=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");_mBtns.id="yahoo-toolbar-btns";_mBtns.setAttribute("style","margin-left:3px");_mBtns.setAttribute("maxheight","32");var moreMenu=_mToolbarDocument.createElementNS(_mNS,"toolbarbutton");moreMenu.setAttribute("class","ytff-button-more-menu");moreMenu.id="yahoo-toolbar-moremenu";moreMenu.setAttribute("hidden","true");moreMenu.setAttribute("maxwidth","20");moreMenu.setAttribute("minwidth","20");moreMenu.setAttribute("type","menu");_mAddEditBtn=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");_mAddEditBtn.id="yahoo-toolbar-add-edit-btn";_mAddEditBtn.setAttribute("style","margin:0px!important;padding:0px !important;border:0px!important");var flexBox=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");flexBox.id="yahoo-toolbar-flexbox";flexBox.setAttribute("flex","10000");var grpSplitter=_mToolbarDocument.createElementNS(_mNS,"splitter");grpSplitter.id="yahoo-toolbar-group-splitter";grpSplitter.setAttribute("resizebefore","flex");grpSplitter.setAttribute("resizeafter","flex");grpSplitter.setAttribute("height","40");grpSplitter.setAttribute("class","groupbox-splitter");_mGroupBtns=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");_mGroupBtns.id="yahoo-toolbar-group-btns";_mGroupBtns.setAttribute("align","right");_mGroupBtns.setAttribute("maxwidth","495");_mRightAlignBtns=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");_mRightAlignBtns.id="yahoo-toolbar-right-btns";_mRightAlignBtns.setAttribute("align","right");_mRightAlignBtns.setAttribute("style","margin:0px!important;padding-bottom:2px;border:0px!important");_mRightSepImg=_mToolbarDocument.createElementNS(_mNS,"image");_mRightSepImg.setAttribute("id","yahoo-toolbar-addsep");_mRightSepImg.setAttribute("src","chrome://ytoolbar/skin/add_separator.png");_mRightSepImg.setAttribute("style","margin:0px;opacity:0.5;padding-top:2px;margin-right:2px;padding-left:4px;");_mRightSepImg.setAttribute("hidden","true");_mRightAlignBtns.appendChild(_mRightSepImg);_mContainer=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");_mContainer.id="yahoo-toolbar-main-container";_mContainer.setAttribute("maxheight","30");_mContainer.setAttribute("flex","2");_mContainer.setAttribute("style","margin-right:3px;margin-left:3px;");_mContainer.appendChild(_mReqBtns);_mContainer.appendChild(_mSplitter);_mContainer.appendChild(_mBtns);_mContainer.appendChild(moreMenu);_mContainer.appendChild(_mAddEditBtn);_mContainer.appendChild(flexBox);_mContainer.appendChild(grpSplitter);_mContainer.appendChild(_mGroupBtns);_mContainer.appendChild(_mRightAlignBtns);_self.toolbar.appendChild(_mContainer);var node={hash:"{\"skin_bk\":\"\",\"skin_left\":\"\",\"skin_ofs\":0,"+"\"skin_g_bgtop\":\"#505050\",\"skin_g_bgbot\":\"#888888\",\"skin_c_bdrdk\":\"#AAAAAA\",\"skin_c_bdrlt\":\"#EEEEEE\","+"\"skin_c_grddk\":\"#FF0000\",\"skin_c_grdlt\":\"#00FF00\",\"skin_t_col\":\"#000000\","+"\"skin_g_t_col\":\"#000000\",\"skin_s_bgcol\":\"#000000\",\"skin_s_t_col\":\"#000000\"}"};_self.setSkinParams(node);}catch(e){yahooError(e);}};this.remove=function(id){try{var nId;for(var i=0;i<_self.removables.length;i++){if(_self.removables[i]&&_self.removables[i].parentNode&&(_self.removables[i].id==id||_self.removables[i].id=="menu_"+id||_self.removables[i].id=="menu_"
+id+"_btn")){_self.removables[i].parentNode.removeChild(_self.removables[i]);_self.removables[i]=null;}}}catch(e){yahooError(e);}};this.clearBM2=function(){try{_self.bookmarks=null;_self.bookmarks=_mDocument.createDocumentFragment();}catch(e){yahooError(e);}};this.buildBM2=function(dom,parent){var recursionBase=(parent===null);var yahooStr=_mLocalStorage.getObject("yahoo-toolbar-boo.yhash");try{if(!parent){parent=_self.bookmarks;}
var uni=CC["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(CI.nsIScriptableUnicodeConverter);uni.charset="utf-8";var node,name,type,url,menu,menupopup,menuitem,str;for(var i=0;i<dom.childNodes.length;i++){node=dom.childNodes[i];if(node.nodeName!="outline"){continue;}
type=node.getAttribute("type");url=node.getAttribute("u");name=uni.ConvertToUnicode(node.getAttribute("text"));name=unescape(name);switch(type){case"F":if(node.getAttribute("text")=="root"&&node.parentNode&&node.parentNode.getAttribute("type")=="ResultSet"){_self.buildBM2(node,parent);}
else if(node.getAttribute("text")=="tags"&&_self.bm2Prefs.DisplayFoldersAs=="TagView"&&node.getAttribute("fid")=="-1"){_self.buildBM2(node,parent);}else{menu=_mDocument.createElementNS(_mNS,"menu");menu.setAttribute("crop","end");menu.setAttribute("label",name);menu.setAttribute("tooltiptext",name);menu.setAttribute("onclick","if(event.button == 1) {YAHOO.YTFF.BookmarksOpenAll(_self.firstChild); YAHOO.YTFF.ButtonHandler(event);}");menu.setAttribute("maxwidth","300px");if(_self.bm2Prefs.DisplayFoldersAs=="TagView"){menu.setAttribute("class","menu-iconic");menu.setAttribute("image","chrome://ytoolbar/skin/tag.gif");}else{menu.setAttribute("class","menu-iconic folder-item");}
menupopup=_mDocument.createElementNS(_mNS,"menupopup");if(_self.bm2FolderSave){var nameStr=name.replace(/\$/g,"$$$$");if(yahooStr!==null){str=yahooStr.wrappedJSObject.object["yahoo.bm.folder.add"].replace("__TITLE__",nameStr);}else{str="Add page to __TITLE__";str=str.replace("__TITLE__",nameStr);}
menuitem=_mDocument.createElementNS(_mNS,"menuitem");menuitem.setAttribute("crop","end");menuitem.setAttribute("label",str);menuitem.setAttribute("tooltiptext",str);menupopup.appendChild(menuitem);menupopup.appendChild(_mDocument.createElementNS(_mNS,"menuseparator"));var func=_self.bm2FolderSave;menuitem.setAttribute("yevent",_self.bm2FolderSave.replace("__FOLDERID__",node.getAttribute("fid")));menuitem.setAttribute("yhash","'id':'boo2_m/fold_add'");menuitem.setAttribute("oncommand","YAHOO.YTFF.ButtonHandler(event);");menuitem.setAttribute("onclick","if(event.button == 1) YAHOO.YTFF.ButtonHandler(event);");}
_self.buildBM2(node,menupopup);var nodeB=menupopup.firstChild;var urlYes=0;while(nodeB){if(nodeB.getAttribute("yurl")&&nodeB.getAttribute("yurl")){urlYes++;}
nodeB=nodeB.nextSibling;}
if(urlYes>=1){var nameStr=name.replace(/\$/g,"$$$$");if(yahooStr!==null){str=yahooStr.wrappedJSObject.object["yahoo.bm.folder.open"];}else{str="Open in Tabs";}
menupopup.appendChild(_mDocument.createElementNS(_mNS,"menuseparator"));menuitem=_mDocument.createElementNS(_mNS,"menuitem");menuitem.setAttribute("crop","end");menuitem.setAttribute("label",str);menuitem.setAttribute("tooltiptext",str);menuitem.setAttribute("yhash","'id':'boo2_m/fold_tabs'");menuitem.setAttribute("oncommand","YAHOO.YTFF.BookmarksOpenAll(this.parentNode); YAHOO.YTFF.ButtonHandler(event);");menuitem.setAttribute("onclick","if(event.button == 1) {YAHOO.YTFF.BookmarksOpenAll(this.parentNode); YAHOO.YTFF.ButtonHandler(event);}");menuitem.setAttribute("maxwidth","300px");menupopup.appendChild(menuitem);}
if((menupopup.childNodes.length<=2)&&(menupopup.childNodes.length>0)){var el=menupopup.childNodes[1];if(el){menupopup.removeChild(el);}}
menu.appendChild(menupopup);parent.appendChild(menu);}
break;case"B":if((node.parentNode.getAttribute("type")=="RecentSave"||node.parentNode.getAttribute("type")=="FrequentUse")&&((node.parentNode.getAttribute("type")==_self.bm2Prefs.OrderBy&&parent.childNodes.length
-1==_self.bm2Prefs.ToolbarDisplay)||parent.childNodes.length==_self.bm2Prefs.ToolbarDisplay)){break;}
menuitem=_mDocument.createElementNS(_mNS,"menuitem");menuitem.setAttribute("crop","end");menuitem.setAttribute("label",name);menuitem.setAttribute("value",node.getAttribute("u"));menuitem.setAttribute("contextmenu","yahoo-toolbar-context");menuitem.setAttribute("tooltiptext",name);url=url.replace(/,/g,"%2C");menuitem.setAttribute("yevent",",4,boo_m,%"+url);menuitem.setAttribute("ytrack","boo_m");menuitem.setAttribute("yfunc","4");menuitem.setAttribute('yurl',url);menuitem.setAttribute('ybid',node.getAttribute("bid"));menuitem.setAttribute("oncommand","YAHOO.YTFF.ButtonHandler(event);");menuitem.setAttribute("onclick","if(event.button == 1) YAHOO.YTFF.ButtonHandler(event);");menuitem.setAttribute("class","menuitem-iconic bookmark-item");if((_self.bm2Prefs.OrderBy=="RecentlySaved"&&node.parentNode.getAttribute("type")=="RecentSave")||(_self.bm2Prefs.OrderBy=="FrequentlyAccessed"&&node.parentNode.getAttribute("type")=="FrequentUse")){_mFileIO.fetchNCacheFavicon(url,menuitem);}else{var bImage=_mFileIO.getFaviconFromCacheWithCallBack(url,true,new WrapperClass(function(bImage){menuitem.setAttribute("image",bImage);}));}
parent.appendChild(menuitem);break;case"Toolbar":var d;for(var n=0;n<node.childNodes.length;n++){d=node.childNodes[n];if(d.nodeName=="outline"&&d.getAttribute("type")=="Pref"){_self.bm2Prefs[d.getAttribute("text")]=d.getAttribute("a");}}
break;case"RecentSave":if((_self.bm2Prefs.ToolbarDisplay-1)===0||node.getAttribute("total")=="0"){break;}
_self.bm2Prefs.ToolbarDisplay=parseInt(node.getAttribute("total"))+1;var recent;if(yahooStr!==null){recent=yahooStr.wrappedJSObject.object["yahoo.bm.quick.recent"];}else{recent="Recently Saved";}
if(_self.bm2Prefs.OrderBy=="RecentlySaved"){var frag=_mDocument.createDocumentFragment();frag.appendChild(_mDocument.createElementNS(_mNS,"menuitem"));frag.lastChild.setAttribute("label",recent);frag.lastChild.setAttribute("tooltiptext",recent);frag.lastChild.style.fontWeight="bold";frag.lastChild.setAttribute("disabled","true");frag.lastChild.style.color="black";_self.buildBM2(node,frag);var sep=_mDocument.createElementNS(_mNS,"menuseparator");sep.setAttribute("id","yahoo-bookmarks-quickaccess-separator");if(parent.qaFolder){parent.insertBefore(frag,parent.qaFolder);parent.insertBefore(sep,parent.qaFolder);parent.qaFolder=null;}else{parent.appendChild(frag);parent.appendChild(sep);}}
else{menu=_mDocument.createElementNS(_mNS,"menu");menu.setAttribute("id","yahoo-bookmarks-quickaccess-folder");menu.setAttribute("label",recent);menu.setAttribute("tooltiptext",recent);if(_self.bm2Prefs.DisplayFoldersAs=="TagView"){menu.setAttribute("class","menu-iconic");menu.setAttribute("image","chrome://ytoolbar/skin/tag.gif");}else{menu.setAttribute("class","menu-iconic folder-item");}
menupopup=_mDocument.createElementNS(_mNS,"menupopup");_self.buildBM2(node,menupopup);menu.appendChild(menupopup);parent.appendChild(menu);parent.qaFolder=menu;}
break;case"FrequentUse":var frequent;if(yahooStr!==null){frequent=yahooStr.wrappedJSObject.object["yahoo.bm.quick.frequent"];}else{frequent="Quick List";}
if((_self.bm2Prefs.ToolbarDisplay-1)==0||node.getAttribute("total")==="0"){break;}
_self.bm2Prefs.ToolbarDisplay=parseInt(node.getAttribute("total"))+1;if(_self.bm2Prefs.OrderBy==="FrequentlyAccessed"){var frag=_mDocument.createDocumentFragment();frag.appendChild(_mDocument.createElementNS(_mNS,"menuitem"));frag.lastChild.setAttribute("label",frequent);frag.lastChild.setAttribute("tooltiptext",frequent);frag.lastChild.style.fontWeight="bold";frag.lastChild.setAttribute("disabled","true");frag.lastChild.style.color="black";_self.buildBM2(node,frag);var sep=_mDocument.createElementNS(_mNS,"menuseparator");sep.setAttribute("id","yahoo-bookmarks-quickaccess-separator");if(parent.qaFolder){parent.insertBefore(frag,parent.qaFolder);parent.insertBefore(sep,parent.qaFolder);parent.qaFolder=null;}else{parent.appendChild(frag);parent.appendChild(sep);}}
else{menu=_mDocument.createElementNS(_mNS,"menu");menu.setAttribute("id","yahoo-bookmarks-quickaccess-folder");menu.setAttribute("label",frequent);menu.setAttribute("tooltiptext",frequent);if(_self.bm2Prefs.DisplayFoldersAs=="TagView"){menu.setAttribute("class","menu-iconic");menu.setAttribute("image","chrome://ytoolbar/skin/tag.gif");}else{menu.setAttribute("class","menu-iconic folder-item");}
menupopup=_mDocument.createElementNS(_mNS,"menupopup");_self.buildBM2(node,menupopup);menu.appendChild(menupopup);parent.appendChild(menu);parent.qaFolder=menu;}
break;}}
uni=null;}catch(e){yahooError(e);}
if(recursionBase&&_mFileIO.isDownloading()){_mFileIO.registerNotifier("yahoo-feed-bookmarks-updated");}};this.bumpUpBM2Usage=function(bid){if(!bid){return;}
var cnt=1;if(_self.bm2Usage[bid]){cnt=parseInt(_self.bm2Usage[bid],10);cnt=(cnt<1?0:cnt)+1;}
_self.bm2Usage[bid]=""+cnt;};this.getBM2UsageString=function(){var str="";for(key in _self.bm2Usage){if(key){str+=(str.length<1?"":",")+key+"|"
+_self.bm2Usage[key];}}
return str;};this.clearBM2Usage=function(){for(key in _self.bm2Usage){_self.bm2Usage[key]=null;}
_self.bm2Usage=[];};try{var _mConfigManager=Components.classes["@yahoo.com/configmanager;1"].getService(Components.interfaces.nsIYahooConfigManager);_self.iconsOnly=_mConfigManager.getBoolValue("options.iconsonly");}catch(e){yahooError(e);}};YahooDomBuilder.prototype={classID:Components.ID("{15e84d13-9bda-4810-ad02-437d2580c87d}"),contractID:"@yahoo.com/dombuilder;1",QueryInterface:XPCOMUtils.generateQI([Components.interfaces.nsIYahooDomBuilder])};if(XPCOMUtils.generateNSGetFactory)
var NSGetFactory=XPCOMUtils.generateNSGetFactory([YahooDomBuilder]);else
var NSGetModule=XPCOMUtils.generateNSGetModule([YahooDomBuilder]);